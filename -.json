{
  "createdAt": "2025-06-13T13:47:33.814Z",
  "updatedAt": "2025-06-13T16:05:57.922Z",
  "id": "Dqsp8D7z4riWNcCU",
  "name": "Github backup",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "id": "e8a5f3d6-1db7-43ec-87d1-feb0462e7ddf",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -760,
        180
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "name"
            }
          ]
        },
        "options": {}
      },
      "id": "de87f2e8-fea4-44b0-830d-23778f40fc06",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "position": [
        -320,
        180
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "list",
        "owner": {
          "__rl": true,
          "value": "zumbador",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "n8n_backups",
          "mode": "list",
          "cachedResultName": "n8n_backups",
          "cachedResultUrl": "https://github.com/zumbador/n8n_backups"
        },
        "filePath": "="
      },
      "id": "a3411232-2ae5-4b71-85aa-fb63a521eb11",
      "name": "List files from repo",
      "type": "n8n-nodes-base.github",
      "position": [
        -540,
        180
      ],
      "webhookId": "354d699e-44b0-4444-9d31-af7fd4ff5561",
      "typeVersion": 1,
      "alwaysOutputData": true,
      "credentials": {
        "githubApi": {
          "id": "LBtQD0iKjRkQ4STc",
          "name": "GitHub backup"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "edit",
        "owner": {
          "__rl": true,
          "value": "zumbador",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "n8n_backups",
          "mode": "list",
          "cachedResultName": "n8n_backups",
          "cachedResultUrl": "https://github.com/zumbador/n8n_backups"
        },
        "filePath": "={{ $('Generate safe filename').item.json.safeFileName }}",
        "fileContent": "={{ $('Generate safe filename').item.json.jsonContent }}",
        "commitMessage": "=Update: {{ $('Generate safe filename').item.json.safeFileName }} - {{ $('Generate safe filename').item.json.commitDate }}"
      },
      "id": "f1947f9b-0607-4fda-8a70-75bd24ba4b53",
      "name": "Update file",
      "type": "n8n-nodes-base.github",
      "position": [
        1220,
        -20
      ],
      "webhookId": "27218087-8df7-474d-a39f-70cfa9c34ec8",
      "typeVersion": 1,
      "credentials": {
        "githubApi": {
          "id": "LBtQD0iKjRkQ4STc",
          "name": "GitHub backup"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $('Aggregate').item.json.name }}",
              "operation": "contains",
              "value2": "={{ $('Generate safe filename').item.json.safeFileName }}"
            }
          ]
        }
      },
      "id": "fe559c27-ac3c-4e32-961a-ae1ca0d72b18",
      "name": "Check if file exists",
      "type": "n8n-nodes-base.if",
      "position": [
        1000,
        80
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "url": "=https://primary-production-a00b4.up.railway.app/api/v1/workflows",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "n8nApi",
        "options": {}
      },
      "id": "fff2c245-5da1-4a04-a552-b2eeb3a8189d",
      "name": "Retrieve workflows",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -100,
        180
      ],
      "typeVersion": 4.2,
      "credentials": {
        "n8nApi": {
          "id": "5XHOo0XHlTPF4J0g",
          "name": "n8n account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "=data",
        "include": "=noOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        120,
        180
      ],
      "id": "2f6ef3ed-8832-474e-805a-1630ca599d2b",
      "name": "Item lists"
    },
    {
      "parameters": {
        "resource": "file",
        "owner": {
          "__rl": true,
          "value": "zumbador",
          "mode": "name"
        },
        "repository": {
          "__rl": true,
          "value": "n8n_backups",
          "mode": "list",
          "cachedResultName": "n8n_backups",
          "cachedResultUrl": "https://github.com/zumbador/n8n_backups"
        },
        "filePath": "={{ $('Generate safe filename').item.json.safeFileName }}",
        "fileContent": "={{ $('Generate safe filename').item.json.jsonContent }}",
        "commitMessage": "=Create: {{ $('Generate safe filename').item.json.safeFileName }} - {{ $('Generate safe filename').item.json.commitDate }}"
      },
      "id": "9148dea3-7af3-430b-88ce-3ceddcd38a45",
      "name": "Upload file",
      "type": "n8n-nodes-base.github",
      "position": [
        1220,
        180
      ],
      "webhookId": "ce4b561b-acb9-4cd8-b76f-4928dada9674",
      "typeVersion": 1,
      "credentials": {
        "githubApi": {
          "id": "LBtQD0iKjRkQ4STc",
          "name": "GitHub backup"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fe4a36ef-9f04-40e3-99bd-cc517a49b440",
              "name": "commitDate",
              "type": "string",
              "value": "={{ $now.format('yyyy-MM-dd_HH-mm-ss') }}"
            },
            {
              "id": "b0fe1bcc-e79c-4a6b-b8b4-44222c8bf4e8",
              "name": "workflowName",
              "type": "string",
              "value": "={{ $json.name || 'unnamed-workflow' }}"
            },
            {
              "id": "c1234567-1234-1234-1234-123456789abc",
              "name": "workflowTag",
              "type": "string",
              "value": "={{ ($json.tags && $json.tags[0] && $json.tags[0].name) ? $json.tags[0].name : 'untagged' }}"
            },
            {
              "id": "d1234567-1234-1234-1234-123456789abc",
              "name": "safeFileName",
              "type": "string",
              "value": "={{ $json.workflowName.replace(/[^a-zA-Z0-9_-]/g, '-').replace(/-+/g, '-').toLowerCase() }}-{{ $json.workflowTag.replace(/[^a-zA-Z0-9_-]/g, '-').replace(/-+/g, '-').toLowerCase() }}.json"
            },
            {
              "id": "e1234567-1234-1234-1234-123456789abc",
              "name": "jsonContent",
              "type": "string",
              "value": "={{ JSON.stringify($('Item lists').item.json, null, 2) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ca16135a-5eb0-4bf7-a4a7-03ad6b2e389d",
      "name": "Generate safe filename",
      "type": "n8n-nodes-base.set",
      "position": [
        340,
        180
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "content": "### Retrieve previous file names from Github",
        "height": 380,
        "width": 300,
        "color": 5
      },
      "id": "f8c623d3-56fc-4139-93ed-6d36d0b51ffc",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -420,
        -40
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Retrieve and process workflows from n8n",
        "height": 380,
        "width": 460,
        "color": 3
      },
      "id": "fe8ae6ea-727a-47f8-800b-10f523ecc2f7",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        50,
        -40
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Generate safe filenames and content",
        "height": 380,
        "width": 460,
        "color": 6
      },
      "id": "3db5ba39-84aa-418c-831a-9cee1418828c",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        270,
        -40
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Commit + edit/create files with error handling",
        "height": 380,
        "width": 460,
        "color": 4
      },
      "id": "d5c55359-f1f5-45ce-90cb-564a64342d42",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        820,
        -140
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "debug1",
              "name": "debugInfo",
              "type": "object",
              "value": "={{ {\n  \"originalName\": $json.workflowName,\n  \"originalTag\": $json.workflowTag,\n  \"safeFileName\": $json.safeFileName,\n  \"commitDate\": $json.commitDate,\n  \"contentLength\": $json.jsonContent.length,\n  \"contentPreview\": $json.jsonContent.substring(0, 100) + '...'\n} }}"
            }
          ]
        },
        "options": {}
      },
      "id": "2f318b16-60fe-4053-ad3c-ff8cf96d1249",
      "name": "Debug Info",
      "type": "n8n-nodes-base.set",
      "position": [
        560,
        180
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "validation1",
              "leftValue": "={{ $json.safeFileName }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            },
            {
              "id": "validation2",
              "leftValue": "={{ $json.jsonContent }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            },
            {
              "id": "validation3",
              "leftValue": "={{ $json.jsonContent.length }}",
              "rightValue": 10,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "70ccdeed-d432-4c08-9754-4f72b03d9202",
      "name": "Validate data",
      "type": "n8n-nodes-base.if",
      "position": [
        780,
        180
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "error1",
              "name": "error",
              "type": "string",
              "value": "Data validation failed - empty filename or content"
            },
            {
              "id": "error2",
              "name": "timestamp",
              "type": "string",
              "value": "={{ $now.format() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3686c3c7-b4d6-4e90-9b6b-efc7e7ecf9ff",
      "name": "Log validation error",
      "type": "n8n-nodes-base.set",
      "position": [
        1000,
        280
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "success1",
              "name": "result",
              "type": "string",
              "value": "File operation completed"
            },
            {
              "id": "success2",
              "name": "fileName",
              "type": "string",
              "value": "={{ $('Generate safe filename').item.json.safeFileName }}"
            },
            {
              "id": "success3",
              "name": "timestamp",
              "type": "string",
              "value": "={{ $now.format() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d08b23c6-8fa3-47e4-83f8-1672a3aa38ae",
      "name": "Log success",
      "type": "n8n-nodes-base.set",
      "position": [
        1440,
        80
      ],
      "typeVersion": 3.4
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "List files from repo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Retrieve workflows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List files from repo": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update file": {
      "main": [
        [
          {
            "node": "Log success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if file exists": {
      "main": [
        [
          {
            "node": "Update file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Upload file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retrieve workflows": {
      "main": [
        [
          {
            "node": "Item lists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item lists": {
      "main": [
        [
          {
            "node": "Generate safe filename",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file": {
      "main": [
        [
          {
            "node": "Log success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate safe filename": {
      "main": [
        [
          {
            "node": "Debug Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Debug Info": {
      "main": [
        [
          {
            "node": "Validate data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate data": {
      "main": [
        [
          {
            "node": "Check if file exists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log validation error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "03e588db-8b46-4ae3-8c74-df675ce39ea3",
  "triggerCount": 0,
  "tags": []
}